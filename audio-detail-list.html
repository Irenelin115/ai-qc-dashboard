<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³æª”æ˜ç´°åˆ—è¡¨ - AIè³ªæª¢ç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .audio-card {
            transition: all 0.3s ease;
        }
        .audio-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        .play-button {
            transition: all 0.2s ease;
        }
        .play-button:hover {
            transform: scale(1.1);
        }
        .stt-text {
            max-height: 60px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .stt-text.expanded {
            max-height: none;
        }
        .severity-high {
            border-left: 4px solid #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
        }
        .severity-medium {
            border-left: 4px solid #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
        }
        .severity-low {
            border-left: 4px solid #10b981;
            background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%);
        }
        .info-card {
            transition: all 0.2s ease;
        }
        .info-card:hover {
            transform: scale(1.02);
        }
        .filter-chip {
            transition: all 0.2s ease;
        }
        .filter-chip:hover {
            transform: translateY(-1px);
        }
        .loading {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="flex items-center text-gray-600 hover:text-gray-900 transition">
                        <i data-lucide="arrow-left" class="w-5 h-5 mr-2"></i>
                        è¿”å›å„€è¡¨æ¿
                    </button>
                    <div class="h-6 w-px bg-gray-300"></div>
                    <h1 class="text-xl font-bold text-gray-900" id="pageTitle">éŸ³æª”æ˜ç´°åˆ—è¡¨</h1>
                    <span class="px-3 py-1 text-sm rounded-full bg-blue-100 text-blue-800" id="issueCategory"></span>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600" id="totalCount">ç¸½è¨ˆ 0 ç­†</span>
                    <button onclick="showSeveritySettings()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition mr-2">
                        <i data-lucide="settings" class="w-4 h-4 mr-2 inline"></i>
                        åš´é‡åº¦è¨­å®š
                    </button>
                    <button onclick="exportAudioList()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                        <i data-lucide="download" class="w-4 h-4 mr-2 inline"></i>
                        åŒ¯å‡ºæ¸…å–®
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Filters -->
    <div class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex flex-wrap items-center gap-4">
                <div class="flex items-center space-x-2">
                    <label class="text-sm font-medium text-gray-700">æ™‚é–“ç¯„åœ:</label>
                    <select id="timeRange" class="border border-gray-300 rounded px-3 py-1 text-sm">
                        <option value="today">ä»Šæ—¥</option>
                        <option value="week">æœ¬é€±</option>
                        <option value="month">æœ¬æœˆ</option>
                        <option value="custom">è‡ªå®šç¾©</option>
                    </select>
                </div>
                
                <div class="flex items-center space-x-2">
                    <label class="text-sm font-medium text-gray-700">å®¢æœäººå“¡:</label>
                    <select id="agentFilter" class="border border-gray-300 rounded px-3 py-1 text-sm">
                        <option value="">å…¨éƒ¨</option>
                        <option value="A001">å¼µå°æ˜ (A001)</option>
                        <option value="A002">æç¾ç² (A002)</option>
                        <option value="A003">ç‹å¤§å‰ (A003)</option>
                        <option value="A004">é™³å°è¯ (A004)</option>
                        <option value="A005">æ—å¿—å¼· (A005)</option>
                    </select>
                </div>

                <div class="flex items-center space-x-2">
                    <label class="text-sm font-medium text-gray-700">åš´é‡ç¨‹åº¦:</label>
                    <select id="severityFilter" class="border border-gray-300 rounded px-3 py-1 text-sm">
                        <option value="">å…¨éƒ¨</option>
                        <option value="high">é«˜</option>
                        <option value="medium">ä¸­</option>
                        <option value="low">ä½</option>
                    </select>
                </div>

                <div class="flex items-center space-x-2">
                    <label class="text-sm font-medium text-gray-700">æœå°‹:</label>
                    <input type="text" id="searchInput" placeholder="å®¢æˆ¶ä»£è™Ÿã€æª”æ¡ˆåç¨±..." 
                           class="border border-gray-300 rounded px-3 py-1 text-sm w-48">
                </div>

                <button onclick="applyFilters()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                    <i data-lucide="filter" class="w-4 h-4 mr-2 inline"></i>
                    å¥—ç”¨ç¯©é¸
                </button>
            </div>
        </div>
    </div>

    <!-- Summary Stats -->
    <div class="max-w-7xl mx-auto px-6 py-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-lg shadow-sm border border-red-200 p-4 hover:shadow-md transition-all">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-sm font-medium text-red-700">é«˜åš´é‡åº¦</div>
                        <div class="text-2xl font-bold text-red-600" id="highSeverityCount">0</div>
                    </div>
                    <div class="text-red-500">
                        <i data-lucide="alert-circle" class="w-8 h-8"></i>
                    </div>
                </div>
            </div>
            <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg shadow-sm border border-orange-200 p-4 hover:shadow-md transition-all">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-sm font-medium text-orange-700">ä¸­åš´é‡åº¦</div>
                        <div class="text-2xl font-bold text-orange-600" id="mediumSeverityCount">0</div>
                    </div>
                    <div class="text-orange-500">
                        <i data-lucide="alert-triangle" class="w-8 h-8"></i>
                    </div>
                </div>
            </div>
            <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg shadow-sm border border-green-200 p-4 hover:shadow-md transition-all">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-sm font-medium text-green-700">ä½åš´é‡åº¦</div>
                        <div class="text-2xl font-bold text-green-600" id="lowSeverityCount">0</div>
                    </div>
                    <div class="text-green-500">
                        <i data-lucide="check-circle" class="w-8 h-8"></i>
                    </div>
                </div>
            </div>
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg shadow-sm border border-blue-200 p-4 hover:shadow-md transition-all">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-sm font-medium text-blue-700">å¹³å‡æ™‚é•·</div>
                        <div class="text-2xl font-bold text-blue-600" id="avgDuration">0</div>
                    </div>
                    <div class="text-blue-500">
                        <i data-lucide="clock" class="w-8 h-8"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio List -->
    <div class="max-w-7xl mx-auto px-6 pb-6">
        <div class="space-y-4" id="audioCardContainer">
            <!-- Audio cards will be populated by JavaScript -->
        </div>

        <!-- Pagination -->
        <div class="mt-6 flex items-center justify-between">
            <div class="text-sm text-gray-700">
                é¡¯ç¤º <span id="showingFrom">1</span> åˆ° <span id="showingTo">20</span> ç­†ï¼Œå…± <span id="totalItems">0</span> ç­†
            </div>
            <div class="flex items-center space-x-2">
                <button onclick="previousPage()" id="prevBtn" class="px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50">
                    ä¸Šä¸€é 
                </button>
                <div class="flex items-center space-x-1" id="pageNumbers">
                    <!-- Page numbers will be populated by JavaScript -->
                </div>
                <button onclick="nextPage()" id="nextBtn" class="px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50">
                    ä¸‹ä¸€é 
                </button>
            </div>
        </div>
    </div>

    <!-- STT Modal -->
    <div id="sttModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] overflow-auto">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900" id="modalTitle">STT è½‰éŒ„æ–‡æœ¬</h3>
                        <button onclick="closeSttModal()" class="text-gray-400 hover:text-gray-600">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                </div>
                <div class="px-6 py-4">
                    <div class="mb-4">
                        <div class="flex items-center space-x-4 text-sm text-gray-600 mb-4">
                            <span>æª”æ¡ˆ: <span class="font-medium" id="modalFileName"></span></span>
                            <span>æ™‚é•·: <span class="font-medium" id="modalDuration"></span></span>
                            <span>å®¢æœ: <span class="font-medium" id="modalAgent"></span></span>
                        </div>
                    </div>
                    <div class="prose max-w-none">
                        <div id="modalSttContent" class="whitespace-pre-wrap text-gray-700 leading-relaxed">
                            <!-- STT content will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 bg-gray-50">
                    <div class="flex justify-end space-x-3">
                        <button onclick="exportSttText()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                            åŒ¯å‡ºæ–‡æœ¬
                        </button>
                        <button onclick="closeSttModal()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition">
                            é—œé–‰
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Severity Settings Modal -->
    <div id="severitySettingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-lg w-full">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">åš´é‡åº¦æ‰£åˆ†è¨­å®š</h3>
                        <button onclick="closeSeveritySettings()" class="text-gray-400 hover:text-gray-600">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                </div>
                <div class="px-6 py-4">
                    <div class="space-y-6">
                        <div class="text-sm text-gray-600 mb-4">
                            è¨­å®šä¸åŒåš´é‡åº¦ç­‰ç´šçš„æ‰£åˆ†åˆ†æ•¸ç¯„åœï¼Œç”¨æ–¼è‡ªå‹•åˆ†é¡éŸ³æª”çš„åš´é‡ç¨‹åº¦ã€‚
                        </div>
                        
                        <!-- é«˜åš´é‡åº¦è¨­å®š -->
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <div class="flex items-center space-x-2 mb-3">
                                <div class="w-4 h-4 bg-red-600 rounded-full"></div>
                                <h4 class="font-semibold text-red-900">é«˜åš´é‡åº¦</h4>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">æœ€ä½åˆ†æ•¸</label>
                                    <input type="number" id="highSeverityMin" min="1" max="20" 
                                           class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-red-500" 
                                           placeholder="8">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">æœ€é«˜åˆ†æ•¸</label>
                                    <input type="number" id="highSeverityMax" min="1" max="20" 
                                           class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-red-500" 
                                           placeholder="20">
                                </div>
                            </div>
                            <div class="mt-2 text-xs text-red-700">
                                ç¯„ä¾‹ï¼šä¿å¯†è¦å®šé•åã€æœªåŸ·è¡Œèº«ä»½é©—è­‰ç­‰åš´é‡é•è¦
                            </div>
                        </div>

                        <!-- ä¸­åš´é‡åº¦è¨­å®š -->
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                            <div class="flex items-center space-x-2 mb-3">
                                <div class="w-4 h-4 bg-orange-600 rounded-full"></div>
                                <h4 class="font-semibold text-orange-900">ä¸­åš´é‡åº¦</h4>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">æœ€ä½åˆ†æ•¸</label>
                                    <input type="number" id="mediumSeverityMin" min="1" max="20" 
                                           class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500" 
                                           placeholder="4">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">æœ€é«˜åˆ†æ•¸</label>
                                    <input type="number" id="mediumSeverityMax" min="1" max="20" 
                                           class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500" 
                                           placeholder="7">
                                </div>
                            </div>
                            <div class="mt-2 text-xs text-orange-700">
                                ç¯„ä¾‹ï¼šå•é¡Œæœªå®Œå…¨è§£æ±ºã€å°ˆæ¥­çŸ¥è­˜ä¸è¶³ç­‰ä¸€èˆ¬é•è¦
                            </div>
                        </div>

                        <!-- ä½åš´é‡åº¦è¨­å®š -->
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="flex items-center space-x-2 mb-3">
                                <div class="w-4 h-4 bg-green-600 rounded-full"></div>
                                <h4 class="font-semibold text-green-900">ä½åš´é‡åº¦</h4>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">æœ€ä½åˆ†æ•¸</label>
                                    <input type="number" id="lowSeverityMin" min="1" max="20" 
                                           class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-green-500" 
                                           placeholder="1">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">æœ€é«˜åˆ†æ•¸</label>
                                    <input type="number" id="lowSeverityMax" min="1" max="20" 
                                           class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-green-500" 
                                           placeholder="3">
                                </div>
                            </div>
                            <div class="mt-2 text-xs text-green-700">
                                ç¯„ä¾‹ï¼šç¼ºå°‘çµæŸèªã€æœªä½¿ç”¨å®¢æˆ¶å§“åç­‰è¼•å¾®å•é¡Œ
                            </div>
                        </div>

                        <!-- é è¨­é¸é … -->
                        <div class="border-t pt-4">
                            <h4 class="font-medium text-gray-900 mb-3">å¿«é€Ÿè¨­å®š</h4>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="applyPresetSeverity('default')" 
                                        class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50 transition">
                                    é è¨­ç¯„åœ (1-3, 4-7, 8-20)
                                </button>
                                <button onclick="applyPresetSeverity('strict')" 
                                        class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50 transition">
                                    åš´æ ¼æ¨¡å¼ (1-2, 3-5, 6-20)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-between">
                    <button onclick="resetSeveritySettings()" class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition">
                        é‡ç½®ç‚ºé è¨­
                    </button>
                    <div class="flex space-x-3">
                        <button onclick="closeSeveritySettings()" 
                                class="px-4 py-2 text-sm border border-gray-300 rounded text-gray-700 hover:bg-gray-50 transition">
                            å–æ¶ˆ
                        </button>
                        <button onclick="applySeveritySettings()" 
                                class="px-4 py-2 text-sm bg-purple-600 text-white rounded hover:bg-purple-700 transition">
                            å¥—ç”¨è¨­å®š
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Global variables
        let currentPage = 1;
        let pageSize = 20;
        let totalPages = 0;
        let currentData = [];
        let allAudioData = [];
        let currentIssueType = '';
        
        // Severity settings - shared with main dashboard
        let severitySettings = {
            high: { min: 8, max: 20 },
            medium: { min: 4, max: 7 },
            low: { min: 1, max: 3 }
        };

        // Sample audio data based on top issues
        const audioDataByIssue = {
            'æœªä½¿ç”¨ç¦®è²Œç”¨èª': [
                {
                    fileName: 'call_20241017_142530_A002_C8859.wav',
                    duration: '05:23',
                    callTime: '2024/10/17 14:25:30',
                    agentId: 'A002',
                    agentName: 'æç¾ç²',
                    createdBy: 'QC001',
                    createdByName: 'è³ªæª¢å“¡ç‹å°èŠ¬',
                    customerId: 'C8859',
                    customerName: 'é™³å…ˆç”Ÿ',
                    severity: 'medium',
                    deduction: 5,
                    sttText: 'å®¢æœï¼šæ‚¨å¥½ï¼Œè«‹å•æœ‰ä»€éº¼éœ€è¦å¹«åŠ©çš„å—ï¼Ÿ\nå®¢æˆ¶ï¼šæˆ‘æƒ³è¦æŸ¥è©¢æˆ‘çš„ä¿å–®ç‹€æ³ã€‚\nå®¢æœï¼šå¥½çš„ï¼Œè«‹æä¾›æ‚¨çš„èº«åˆ†è­‰å­—è™Ÿã€‚\nå®¢æˆ¶ï¼šA123456789\nå®¢æœï¼šæŸ¥åˆ°äº†ï¼Œæ‚¨çš„ä¿å–®ç›®å‰æ­£å¸¸ç¹³è²»ä¸­ã€‚\nå®¢æˆ¶ï¼šé‚£æˆ‘æƒ³è¦è®Šæ›´å—ç›Šäººå¯ä»¥å—ï¼Ÿ\nå®¢æœï¼šå¯ä»¥ï¼Œä½†éœ€è¦å¡«å¯«è®Šæ›´ç”³è«‹æ›¸ã€‚\nå®¢æˆ¶ï¼šå¥½çš„è¬è¬ã€‚\nå®¢æœï¼šä¸å®¢æ°£ã€‚'
                },
                {
                    fileName: 'call_20241017_135420_A003_C7742.wav',
                    duration: '03:45',
                    callTime: '2024/10/17 13:54:20',
                    agentId: 'A003',
                    agentName: 'ç‹å¤§å‰',
                    createdBy: 'QC002',
                    createdByName: 'è³ªæª¢å“¡æ—å°ç¾',
                    customerId: 'C7742',
                    customerName: 'å¼µå¥³å£«',
                    severity: 'high',
                    deduction: 8,
                    sttText: 'å®¢æœï¼šå–‚ï¼Ÿ\nå®¢æˆ¶ï¼šä½ å¥½ï¼Œæˆ‘æƒ³è¦ç†è³ ç”³è«‹ã€‚\nå®¢æœï¼šä»€éº¼ç†è³ ï¼Ÿ\nå®¢æˆ¶ï¼šæˆ‘ä¸Šå€‹æœˆè»Šç¦ï¼Œæƒ³è¦ç”³è«‹ç†è³ ã€‚\nå®¢æœï¼šé‚£ä½ è¦å¡«è¡¨æ ¼ï¼Œç„¶å¾Œæº–å‚™è³‡æ–™ã€‚\nå®¢æˆ¶ï¼šä»€éº¼è³‡æ–™ï¼Ÿ\nå®¢æœï¼šå°±è¨ºæ–·æ›¸ã€æ”¶æ“šé€™äº›ã€‚\nå®¢æˆ¶ï¼šå¥½å§ã€‚\nå®¢æœï¼šé‚„æœ‰å…¶ä»–å•é¡Œå—ï¼Ÿ\nå®¢æˆ¶ï¼šæ²’æœ‰äº†ã€‚\nå®¢æœï¼šé‚£å°±é€™æ¨£ã€‚'
                },
                {
                    fileName: 'call_20241017_161155_A005_C9123.wav',
                    duration: '07:12',
                    callTime: '2024/10/17 16:11:55',
                    agentId: 'A005',
                    agentName: 'æ—å¿—å¼·',
                    createdBy: 'QC001',
                    createdByName: 'è³ªæª¢å“¡ç‹å°èŠ¬',
                    customerId: 'C9123',
                    customerName: 'åŠ‰å¤ªå¤ª',
                    severity: 'low',
                    deduction: 3,
                    sttText: 'å®¢æœï¼šæ‚¨å¥½ï¼Œé€™è£¡æ˜¯ä¿éšªå…¬å¸ï¼Œè«‹å•æœ‰ä»€éº¼å¯ä»¥ç‚ºæ‚¨æœå‹™çš„ï¼Ÿ\nå®¢æˆ¶ï¼šæˆ‘æƒ³è¦äº†è§£ä¸€ä¸‹æ„å¤–éšªçš„ç†è³ ç¯„åœã€‚\nå®¢æœï¼šå¥½çš„ï¼Œæ„å¤–éšªä¸»è¦ç†è³ å› ç‚ºæ„å¤–äº‹æ•…é€ æˆçš„é†«ç™‚è²»ç”¨å’Œæ®˜å»¢çµ¦ä»˜ã€‚\nå®¢æˆ¶ï¼šé‚£åŒ…æ‹¬å“ªäº›æ„å¤–å‘¢ï¼Ÿ\nå®¢æœï¼šåŒ…æ‹¬äº¤é€šäº‹æ•…ã€è·Œå€’ã€ç‡’ç‡™å‚·ç­‰éç–¾ç—…åŸå› é€ æˆçš„å‚·å®³ã€‚\nå®¢æˆ¶ï¼šäº†è§£ï¼Œé‚£ç†è³ é‡‘é¡æ˜¯æ€éº¼è¨ˆç®—çš„ï¼Ÿ\nå®¢æœï¼šæœƒä¾ç…§æ‚¨æŠ•ä¿çš„ä¿é¡å’Œé†«ç™‚è²»ç”¨æ”¶æ“šä¾†è¨ˆç®—ã€‚\nå®¢æˆ¶ï¼šå¥½çš„ï¼Œè¬è¬ä½ çš„èªªæ˜ã€‚\nå®¢æœï¼šå—¯ï¼Œæ²’äº‹ã€‚'
                }
            ],
            'å•é¡Œæœªå®Œå…¨è§£æ±º': [
                {
                    fileName: 'call_20241017_093025_A001_C5566.wav',
                    duration: '08:45',
                    callTime: '2024/10/17 09:30:25',
                    agentId: 'A001',
                    agentName: 'å¼µå°æ˜',
                    createdBy: 'QC003',
                    createdByName: 'è³ªæª¢å“¡é™³å°è¯',
                    customerId: 'C5566',
                    customerName: 'é»ƒå…ˆç”Ÿ',
                    severity: 'high',
                    deduction: 12,
                    sttText: 'å®¢æœï¼šæ‚¨å¥½ï¼Œæ„Ÿè¬æ‚¨ä¾†é›»ï¼Œæˆ‘æ˜¯å¼µå°æ˜ï¼Œè«‹å•æœ‰ä»€éº¼å¯ä»¥ç‚ºæ‚¨æœå‹™çš„ï¼Ÿ\nå®¢æˆ¶ï¼šæˆ‘çš„ä¿éšªç†è³ æ¡ˆä»¶å·²ç¶“é€ä»¶å…©å€‹æœˆäº†ï¼Œç‚ºä»€éº¼é‚„æ²’æœ‰ä¸‹ä¾†ï¼Ÿ\nå®¢æœï¼šè«‹æ‚¨ç¨ç­‰ï¼Œæˆ‘å¹«æ‚¨æŸ¥è©¢ä¸€ä¸‹æ¡ˆä»¶ç‹€æ³ã€‚è«‹æä¾›æ‚¨çš„ä¿å–®è™Ÿç¢¼ã€‚\nå®¢æˆ¶ï¼šPL202401234567\nå®¢æœï¼šå¥½çš„ï¼Œæˆ‘æŸ¥åˆ°æ‚¨çš„æ¡ˆä»¶ç›®å‰åœ¨æ ¸ä¿éƒ¨é–€å¯©æ ¸ä¸­ã€‚\nå®¢æˆ¶ï¼šç‚ºä»€éº¼è¦é€™éº¼ä¹…ï¼Ÿæˆ‘æ€¥éœ€é€™ç­†éŒ¢ã€‚\nå®¢æœï¼šå› ç‚ºæ‚¨çš„æ¡ˆä»¶é‡‘é¡æ¯”è¼ƒå¤§ï¼Œéœ€è¦è©³ç´°å¯©æ ¸ã€‚\nå®¢æˆ¶ï¼šé‚£ä»€éº¼æ™‚å€™æœƒæœ‰çµæœï¼Ÿ\nå®¢æœï¼šé€™å€‹æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šï¼Œè¦å•æ ¸ä¿éƒ¨é–€ã€‚\nå®¢æˆ¶ï¼šé‚£ä½ å¯ä»¥å¹«æˆ‘å•å—ï¼Ÿ\nå®¢æœï¼šæˆ‘ç­‰ä¸€ä¸‹æœƒå¹«æ‚¨åæ˜ ã€‚\nå®¢æˆ¶ï¼šä»€éº¼æ™‚å€™æœƒå›è¦†æˆ‘ï¼Ÿ\nå®¢æœï¼šå¤§æ¦‚ä¸€é€±å…§æœƒæœ‰äººè¯çµ¡æ‚¨ã€‚'
                },
                {
                    fileName: 'call_20241017_112215_A004_C3344.wav',
                    duration: '06:33',
                    callTime: '2024/10/17 11:22:15',
                    agentId: 'A004',
                    agentName: 'é™³å°è¯',
                    createdBy: 'QC002',
                    createdByName: 'è³ªæª¢å“¡æ—å°ç¾',
                    customerId: 'C3344',
                    customerName: 'å³å°å§',
                    severity: 'medium',
                    deduction: 8,
                    sttText: 'å®¢æœï¼šæ‚¨å¥½ï¼Œé€™è£¡æ˜¯å®¢æœä¸­å¿ƒï¼Œæˆ‘æ˜¯é™³å°è¯ï¼Œè«‹å•æœ‰ä»€éº¼å¯ä»¥å”åŠ©æ‚¨çš„ï¼Ÿ\nå®¢æˆ¶ï¼šæˆ‘æƒ³è¦æ›´æ”¹æˆ‘çš„é€šè¨Šåœ°å€ã€‚\nå®¢æœï¼šå¥½çš„ï¼Œè«‹æä¾›æ‚¨çš„èº«åˆ†è­‰å­—è™Ÿå’Œä¿å–®è™Ÿç¢¼ã€‚\nå®¢æˆ¶ï¼šèº«åˆ†è­‰å­—è™Ÿæ˜¯B987654321ï¼Œä¿å–®è™Ÿç¢¼æ˜¯PL202401567890\nå®¢æœï¼šå¥½çš„ï¼Œè«‹å•æ‚¨è¦æ›´æ”¹æˆä»€éº¼åœ°å€ï¼Ÿ\nå®¢æˆ¶ï¼šå°åŒ—å¸‚ä¿¡ç¾©å€æ¾é«˜è·¯123è™Ÿ4æ¨“\nå®¢æœï¼šæˆ‘å·²ç¶“å¹«æ‚¨ç™»è¨˜äº†ï¼Œå¤§æ¦‚3-5å€‹å·¥ä½œå¤©æœƒå®Œæˆæ›´æ”¹ã€‚\nå®¢æˆ¶ï¼šé‚£æˆ‘æ€éº¼çŸ¥é“å·²ç¶“æ›´æ”¹æˆåŠŸäº†ï¼Ÿ\nå®¢æœï¼šç³»çµ±æœƒè‡ªå‹•æ›´æ–°ã€‚\nå®¢æˆ¶ï¼šä½†æ˜¯æˆ‘æ€éº¼ç¢ºèªå‘¢ï¼Ÿæœƒæœ‰é€šçŸ¥å—ï¼Ÿ\nå®¢æœï¼šé€™å€‹...æˆ‘ä¸å¤ªç¢ºå®šï¼Œæ‚¨å¯ä»¥éå¹¾å¤©å†æ‰“é›»è©±ä¾†ç¢ºèªã€‚'
                }
            ],
            'å›æ‡‰æ™‚é–“éé•·': [
                {
                    fileName: 'call_20241017_145030_A002_C6677.wav',
                    duration: '04:58',
                    callTime: '2024/10/17 14:50:30',
                    agentId: 'A002',
                    agentName: 'æç¾ç²',
                    createdBy: 'QC001',
                    createdByName: 'è³ªæª¢å“¡ç‹å°èŠ¬',
                    customerId: 'C6677',
                    customerName: 'å¾å…ˆç”Ÿ',
                    severity: 'medium',
                    deduction: 4,
                    sttText: 'å®¢æœï¼šæ‚¨å¥½ï¼Œæ„Ÿè¬æ‚¨ä¾†é›»ï¼Œæˆ‘æ˜¯æç¾ç²ï¼Œè«‹å•æœ‰ä»€éº¼å¯ä»¥ç‚ºæ‚¨æœå‹™çš„ï¼Ÿ\nå®¢æˆ¶ï¼šæˆ‘æƒ³è¦æŸ¥è©¢æˆ‘çš„ä¿å–®ç¾é‡‘åƒ¹å€¼ã€‚\nå®¢æœï¼šå¥½çš„ï¼Œè«‹ç¨ç­‰ä¸€ä¸‹...(æ²‰é»˜15ç§’)...æŠ±æ­‰è®“æ‚¨ä¹…ç­‰äº†ï¼Œè«‹æä¾›æ‚¨çš„ä¿å–®è™Ÿç¢¼ã€‚\nå®¢æˆ¶ï¼šPL202401345678\nå®¢æœï¼šå¥½çš„ï¼Œæˆ‘å¹«æ‚¨æŸ¥è©¢...(æ²‰é»˜20ç§’)...è«‹å•æ‚¨æ˜¯è¦æŸ¥è©¢å“ªä¸€å¼µä¿å–®å‘¢ï¼Ÿ\nå®¢æˆ¶ï¼šå°±å‰›æ‰é‚£å€‹è™Ÿç¢¼å•Šã€‚\nå®¢æœï¼šæŠ±æ­‰ï¼Œæˆ‘å†æŸ¥ä¸€æ¬¡...(æ²‰é»˜18ç§’)...æ‚¨çš„ä¿å–®ç¾é‡‘åƒ¹å€¼æ˜¯18è¬5åƒå…ƒã€‚\nå®¢æˆ¶ï¼šå¥½çš„ï¼Œè¬è¬ã€‚'
                }
            ],
            'å°ˆæ¥­çŸ¥è­˜ä¸è¶³': [
                {
                    fileName: 'call_20241017_105540_A005_C1122.wav',
                    duration: '09:22',
                    callTime: '2024/10/17 10:55:40',
                    agentId: 'A005',
                    agentName: 'æ—å¿—å¼·',
                    createdBy: 'QC003',
                    createdByName: 'è³ªæª¢å“¡é™³å°è¯',
                    customerId: 'C1122',
                    customerName: 'æ–¹å°å§',
                    severity: 'high',
                    deduction: 10,
                    sttText: 'å®¢æœï¼šæ‚¨å¥½ï¼Œæˆ‘æ˜¯æ—å¿—å¼·ï¼Œè«‹å•æœ‰ä»€éº¼å¯ä»¥ç‚ºæ‚¨æœå‹™çš„ï¼Ÿ\nå®¢æˆ¶ï¼šæˆ‘æƒ³è¦äº†è§£ä¸€ä¸‹æŠ•è³‡å‹ä¿å–®çš„è²»ç”¨çµæ§‹ã€‚\nå®¢æœï¼šå¥½çš„ï¼ŒæŠ•è³‡å‹ä¿å–®å°±æ˜¯...å—¯...å°±æ˜¯å¯ä»¥æŠ•è³‡çš„ä¿å–®ã€‚\nå®¢æˆ¶ï¼šæˆ‘çŸ¥é“ï¼Œä½†æ˜¯è²»ç”¨æ€éº¼ç®—å‘¢ï¼Ÿæœ‰å“ªäº›è²»ç”¨ï¼Ÿ\nå®¢æœï¼šè²»ç”¨çš„è©±...æœ‰ç®¡ç†è²»...é‚„æœ‰å…¶ä»–è²»ç”¨ã€‚\nå®¢æˆ¶ï¼šå…·é«”æ˜¯å¤šå°‘å‘¢ï¼Ÿ\nå®¢æœï¼šé€™å€‹æˆ‘è¦æŸ¥ä¸€ä¸‹...æ‚¨ç¨ç­‰ã€‚\nå®¢æˆ¶ï¼šå¥½ã€‚\nå®¢æœï¼šç®¡ç†è²»å¤§æ¦‚æ˜¯...æˆ‘ä¸å¤ªç¢ºå®šï¼Œè¦ä¸æ‚¨ç•™å€‹é›»è©±ï¼Œæˆ‘è«‹å°ˆå“¡å›é›»çµ¦æ‚¨ï¼Ÿ\nå®¢æˆ¶ï¼šå¯æ˜¯æˆ‘ç¾åœ¨å°±æƒ³çŸ¥é“å•Šã€‚\nå®¢æœï¼šçœŸçš„ä¸å¥½æ„æ€ï¼Œé€™å€‹æ¯”è¼ƒè¤‡é›œï¼Œæˆ‘å¯èƒ½èªªä¸æ¸…æ¥šã€‚'
                }
            ],
            'ç¼ºå°‘çµæŸèª': [
                {
                    fileName: 'call_20241017_164420_A003_C4455.wav',
                    duration: '02:31',
                    callTime: '2024/10/17 16:44:20',
                    agentId: 'A003',
                    agentName: 'ç‹å¤§å‰',
                    createdBy: 'QC002',
                    createdByName: 'è³ªæª¢å“¡æ—å°ç¾',
                    customerId: 'C4455',
                    customerName: 'æå¤ªå¤ª',
                    severity: 'low',
                    deduction: 4,
                    sttText: 'å®¢æœï¼šæ‚¨å¥½ï¼Œè«‹å•æœ‰ä»€éº¼éœ€è¦å¹«åŠ©çš„ï¼Ÿ\nå®¢æˆ¶ï¼šæˆ‘æƒ³è¦æŸ¥è©¢æˆ‘ä¸Šå€‹æœˆçš„ç¹³è²»è¨˜éŒ„ã€‚\nå®¢æœï¼šè«‹æä¾›æ‚¨çš„ä¿å–®è™Ÿç¢¼ã€‚\nå®¢æˆ¶ï¼šPL202401789012\nå®¢æœï¼šæ‚¨ä¸Šå€‹æœˆå·²ç¶“æ­£å¸¸ç¹³è²»äº†ï¼Œé‡‘é¡æ˜¯3500å…ƒã€‚\nå®¢æˆ¶ï¼šå¥½çš„ï¼Œè¬è¬ã€‚\nå®¢æœï¼šå—¯ã€‚'
                }
            ]
        };

        // Load severity settings from localStorage
        function loadSeveritySettings() {
            const saved = localStorage.getItem('severitySettings');
            if (saved) {
                severitySettings = JSON.parse(saved);
            }
        }

        // Classify severity based on score
        function classifySeverity(score) {
            if (score >= severitySettings.high.min && score <= severitySettings.high.max) {
                return 'high';
            } else if (score >= severitySettings.medium.min && score <= severitySettings.medium.max) {
                return 'medium';
            } else if (score >= severitySettings.low.min && score <= severitySettings.low.max) {
                return 'low';
            }
            return 'low'; // Default fallback
        }

        // Update all audio data with dynamic severity classification
        function updateAudioSeverityClassification() {
            allAudioData.forEach(audio => {
                audio.severity = classifySeverity(audio.deduction);
            });
            currentData.forEach(audio => {
                audio.severity = classifySeverity(audio.deduction);
            });
        }

        // Initialize page
        function initPage() {
            // Load severity settings first
            loadSeveritySettings();
            
            // Get issue type from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            currentIssueType = urlParams.get('issue') || 'æœªä½¿ç”¨ç¦®è²Œç”¨èª';
            
            // Update page title and category
            document.getElementById('pageTitle').textContent = `${currentIssueType} - éŸ³æª”æ˜ç´°`;
            document.getElementById('issueCategory').textContent = currentIssueType;
            
            // Load data for current issue type
            allAudioData = audioDataByIssue[currentIssueType] || [];
            currentData = [...allAudioData];
            
            // Update severity classification based on custom settings
            updateAudioSeverityClassification();
            
            // Update stats
            updateStats();
            
            // Render table
            renderTable();
            
            // Setup pagination
            setupPagination();
        }

        // Update statistics
        function updateStats() {
            const highSeverity = currentData.filter(item => item.severity === 'high').length;
            const mediumSeverity = currentData.filter(item => item.severity === 'medium').length;
            const lowSeverity = currentData.filter(item => item.severity === 'low').length;
            
            const totalDuration = currentData.reduce((sum, item) => {
                const [min, sec] = item.duration.split(':').map(Number);
                return sum + min * 60 + sec;
            }, 0);
            const avgDurationSeconds = totalDuration / currentData.length;
            const avgMin = Math.floor(avgDurationSeconds / 60);
            const avgSec = Math.floor(avgDurationSeconds % 60);
            
            document.getElementById('highSeverityCount').textContent = highSeverity;
            document.getElementById('mediumSeverityCount').textContent = mediumSeverity;
            document.getElementById('lowSeverityCount').textContent = lowSeverity;
            document.getElementById('avgDuration').textContent = `${avgMin}:${avgSec.toString().padStart(2, '0')}`;
            document.getElementById('totalCount').textContent = `ç¸½è¨ˆ ${currentData.length} ç­†`;
        }

        // Render cards
        function renderTable() {
            const container = document.getElementById('audioCardContainer');
            container.innerHTML = '';
            
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, currentData.length);
            const pageData = currentData.slice(startIndex, endIndex);
            
            pageData.forEach((audio, index) => {
                const card = createAudioCard(audio, startIndex + index);
                container.appendChild(card);
            });
            
            lucide.createIcons();
        }

        // Create audio card
        function createAudioCard(audio, index) {
            const card = document.createElement('div');
            const severityClass = `severity-${audio.severity}`;
            card.className = `audio-card bg-white rounded-lg shadow-sm border hover:shadow-md ${severityClass}`;
            
            const severityText = {
                high: 'é«˜',
                medium: 'ä¸­',
                low: 'ä½'
            };
            
            const severityColor = {
                high: 'bg-red-100 text-red-800 border-red-200',
                medium: 'bg-orange-100 text-orange-800 border-orange-200',
                low: 'bg-green-100 text-green-800 border-green-200'
            };

            const severityIcon = {
                high: 'ğŸ”´',
                medium: 'ğŸŸ¡', 
                low: 'ğŸŸ¢'
            };
            
            card.innerHTML = `
                <div class="p-6">
                    <div class="flex items-start justify-between mb-4">
                        <!-- å·¦å´ï¼šæª”æ¡ˆåŸºæœ¬è³‡è¨Š -->
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <button onclick="playAudio('${audio.fileName}')" class="play-button bg-blue-600 text-white p-3 rounded-full hover:bg-blue-700 transition flex-shrink-0">
                                    <i data-lucide="play" class="w-5 h-5"></i>
                                </button>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-1">${audio.fileName}</h3>
                                    <div class="flex items-center space-x-4 text-sm text-gray-600">
                                        <span class="flex items-center"><i data-lucide="clock" class="w-4 h-4 mr-1"></i>${audio.duration}</span>
                                        <span class="flex items-center"><i data-lucide="hard-drive" class="w-4 h-4 mr-1"></i>${Math.floor(Math.random() * 5 + 2)}.${Math.floor(Math.random() * 99)}MB</span>
                                        <span class="flex items-center"><i data-lucide="calendar" class="w-4 h-4 mr-1"></i>${audio.callTime}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- å³å´ï¼šåš´é‡åº¦æ¨™ç±¤ -->
                        <div class="flex items-center space-x-2">
                            <span class="px-3 py-1 text-sm font-medium rounded-full border ${severityColor[audio.severity]}">
                                ${severityIcon[audio.severity]} ${severityText[audio.severity]}åš´é‡åº¦
                            </span>
                            <span class="px-2 py-1 text-xs font-bold rounded-full bg-red-100 text-red-800">-${audio.deduction}åˆ†</span>
                        </div>
                    </div>
                    
                    <!-- è©³ç´°è³‡è¨Šå¡ç‰‡ -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <!-- å®¢æˆ¶è³‡è¨Š -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-2 flex items-center">
                                <i data-lucide="user" class="w-4 h-4 mr-2"></i>å®¢æˆ¶è³‡è¨Š
                            </h4>
                            <div class="space-y-1 text-sm">
                                <div class="text-gray-900 font-medium">${audio.customerName}</div>
                                <div class="text-gray-600">ID: ${audio.customerId}</div>
                                <div class="text-gray-600">é€šè©±é¡å‹: ä¿éšªè«®è©¢</div>
                            </div>
                        </div>
                        
                        <!-- å®¢æœè³‡è¨Š -->
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-2 flex items-center">
                                <i data-lucide="headphones" class="w-4 h-4 mr-2"></i>å®¢æœè³‡è¨Š
                            </h4>
                            <div class="space-y-1 text-sm">
                                <div class="text-gray-900 font-medium">${audio.agentName}</div>
                                <div class="text-gray-600">ID: ${audio.agentId}</div>
                                <div class="text-gray-600">å»ºç«‹: ${audio.createdByName}</div>
                            </div>
                        </div>
                        
                        <!-- æ‰£åˆ†è©³æƒ… -->
                        <div class="bg-yellow-50 rounded-lg p-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-2 flex items-center">
                                <i data-lucide="alert-triangle" class="w-4 h-4 mr-2"></i>æ‰£åˆ†è©³æƒ…
                            </h4>
                            <div class="space-y-1 text-sm">
                                <div class="text-gray-900 font-medium">æŒ‡æ¨™: ${currentIssueType}</div>
                                <div class="text-gray-600">æ™‚é–“é»: ${Math.floor(Math.random() * 3 + 1)}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}</div>
                                <div class="text-gray-600">å½±éŸ¿: æœå‹™å“è³ª</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ“ä½œæŒ‰éˆ• -->
                    <div class="flex items-center justify-between pt-4 border-t border-gray-200">
                        <div class="flex space-x-3">
                            <button onclick="showSttModal('${audio.fileName}')" class="inline-flex items-center px-3 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-lg hover:bg-blue-100 transition">
                                <i data-lucide="file-text" class="w-4 h-4 mr-2"></i>æŸ¥çœ‹STT
                            </button>
                            <button onclick="downloadAudio('${audio.fileName}')" class="inline-flex items-center px-3 py-2 text-sm font-medium text-green-600 bg-green-50 rounded-lg hover:bg-green-100 transition">
                                <i data-lucide="download" class="w-4 h-4 mr-2"></i>ä¸‹è¼‰éŸ³æª”
                            </button>
                            <button onclick="addToTraining('${audio.fileName}')" class="inline-flex items-center px-3 py-2 text-sm font-medium text-purple-600 bg-purple-50 rounded-lg hover:bg-purple-100 transition">
                                <i data-lucide="brain" class="w-4 h-4 mr-2"></i>åŠ å…¥è¨“ç·´
                            </button>
                        </div>
                        
                        <!-- å¿«é€Ÿè³‡è¨Š -->
                        <div class="text-xs text-gray-500">
                            #${String(index + 1).padStart(3, '0')}
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Setup pagination
        function setupPagination() {
            totalPages = Math.ceil(currentData.length / pageSize);
            
            const showingFrom = (currentPage - 1) * pageSize + 1;
            const showingTo = Math.min(currentPage * pageSize, currentData.length);
            
            document.getElementById('showingFrom').textContent = showingFrom;
            document.getElementById('showingTo').textContent = showingTo;
            document.getElementById('totalItems').textContent = currentData.length;
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;
            
            // Generate page numbers
            const pageNumbers = document.getElementById('pageNumbers');
            pageNumbers.innerHTML = '';
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    const button = document.createElement('button');
                    button.className = `px-3 py-2 border text-sm font-medium ${i === currentPage ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'}`;
                    button.textContent = i;
                    button.onclick = () => goToPage(i);
                    pageNumbers.appendChild(button);
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    const span = document.createElement('span');
                    span.textContent = '...';
                    span.className = 'px-2 py-2 text-gray-500';
                    pageNumbers.appendChild(span);
                }
            }
        }

        // Navigation functions
        function goToPage(page) {
            currentPage = page;
            renderTable();
            setupPagination();
        }

        function previousPage() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                goToPage(currentPage + 1);
            }
        }

        // Filter functions
        function applyFilters() {
            const timeRange = document.getElementById('timeRange').value;
            const agentFilter = document.getElementById('agentFilter').value;
            const severityFilter = document.getElementById('severityFilter').value;
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            
            currentData = allAudioData.filter(audio => {
                // Agent filter
                if (agentFilter && audio.agentId !== agentFilter) return false;
                
                // Severity filter
                if (severityFilter && audio.severity !== severityFilter) return false;
                
                // Search filter
                if (searchInput && 
                    !audio.fileName.toLowerCase().includes(searchInput) &&
                    !audio.customerId.toLowerCase().includes(searchInput) &&
                    !audio.customerName.toLowerCase().includes(searchInput)) {
                    return false;
                }
                
                return true;
            });
            
            currentPage = 1;
            updateStats();
            renderTable();
            setupPagination();
        }

        // Modal functions
        function showSttModal(fileName) {
            const audio = allAudioData.find(a => a.fileName === fileName);
            if (!audio) return;
            
            document.getElementById('modalFileName').textContent = audio.fileName;
            document.getElementById('modalDuration').textContent = audio.duration;
            document.getElementById('modalAgent').textContent = `${audio.agentName} (${audio.agentId})`;
            document.getElementById('modalSttContent').textContent = audio.sttText;
            
            document.getElementById('sttModal').classList.remove('hidden');
        }

        function closeSttModal() {
            document.getElementById('sttModal').classList.add('hidden');
        }

        // Action functions
        function playAudio(fileName) {
            alert(`æ’­æ”¾éŸ³æª”: ${fileName}`);
        }

        function downloadAudio(fileName) {
            alert(`ä¸‹è¼‰éŸ³æª”: ${fileName}`);
        }

        function addToTraining(fileName) {
            alert(`å·²å°‡ ${fileName} åŠ å…¥è¨“ç·´ç´ æåº«`);
        }

        function exportAudioList() {
            alert('åŒ¯å‡ºéŸ³æª”æ¸…å–®åŠŸèƒ½é–‹ç™¼ä¸­...');
        }

        function exportSttText() {
            const sttContent = document.getElementById('modalSttContent').textContent;
            const blob = new Blob([sttContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'stt_transcript.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function goBack() {
            window.history.back();
        }

        // Severity Settings Functions
        function saveSeveritySettings() {
            localStorage.setItem('severitySettings', JSON.stringify(severitySettings));
        }

        function showSeveritySettings() {
            updateSeverityInputs();
            document.getElementById('severitySettingsModal').classList.remove('hidden');
        }

        function closeSeveritySettings() {
            document.getElementById('severitySettingsModal').classList.add('hidden');
        }

        function updateSeverityInputs() {
            document.getElementById('highSeverityMin').value = severitySettings.high.min;
            document.getElementById('highSeverityMax').value = severitySettings.high.max;
            document.getElementById('mediumSeverityMin').value = severitySettings.medium.min;
            document.getElementById('mediumSeverityMax').value = severitySettings.medium.max;
            document.getElementById('lowSeverityMin').value = severitySettings.low.min;
            document.getElementById('lowSeverityMax').value = severitySettings.low.max;
        }

        function applySeveritySettings() {
            const highMin = parseInt(document.getElementById('highSeverityMin').value);
            const highMax = parseInt(document.getElementById('highSeverityMax').value);
            const mediumMin = parseInt(document.getElementById('mediumSeverityMin').value);
            const mediumMax = parseInt(document.getElementById('mediumSeverityMax').value);
            const lowMin = parseInt(document.getElementById('lowSeverityMin').value);
            const lowMax = parseInt(document.getElementById('lowSeverityMax').value);

            // Validation
            if (highMin >= highMax || mediumMin >= mediumMax || lowMin >= lowMax) {
                alert('æœ€ä½åˆ†æ•¸å¿…é ˆå°æ–¼æœ€é«˜åˆ†æ•¸');
                return;
            }

            if (lowMax >= mediumMin || mediumMax >= highMin) {
                alert('åˆ†æ•¸ç¯„åœä¸èƒ½é‡ç–Šï¼Œè«‹ç¢ºä¿ï¼šä½åš´é‡åº¦ < ä¸­åš´é‡åº¦ < é«˜åš´é‡åº¦');
                return;
            }

            // Update settings
            severitySettings = {
                high: { min: highMin, max: highMax },
                medium: { min: mediumMin, max: mediumMax },
                low: { min: lowMin, max: lowMax }
            };

            saveSeveritySettings();
            updateAudioSeverityClassification();
            updateStats();
            renderTable();
            closeSeveritySettings();
            
            showSuccessMessage('åš´é‡åº¦è¨­å®šå·²æ›´æ–°');
        }

        function resetSeveritySettings() {
            severitySettings = {
                high: { min: 8, max: 20 },
                medium: { min: 4, max: 7 },
                low: { min: 1, max: 3 }
            };
            updateSeverityInputs();
        }

        function applyPresetSeverity(presetType) {
            if (presetType === 'default') {
                severitySettings = {
                    high: { min: 8, max: 20 },
                    medium: { min: 4, max: 7 },
                    low: { min: 1, max: 3 }
                };
            } else if (presetType === 'strict') {
                severitySettings = {
                    high: { min: 6, max: 20 },
                    medium: { min: 3, max: 5 },
                    low: { min: 1, max: 2 }
                };
            }
            updateSeverityInputs();
        }

        function showSuccessMessage(message) {
            const messageEl = document.createElement('div');
            messageEl.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            messageEl.textContent = message;
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.style.opacity = '0';
                messageEl.style.transition = 'opacity 0.3s ease';
                setTimeout(() => {
                    if (messageEl.parentNode) {
                        messageEl.parentNode.removeChild(messageEl);
                    }
                }, 300);
            }, 3000);
        }

        // Initialize page when DOM is loaded
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>